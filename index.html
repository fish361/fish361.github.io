<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>首页 - 文化打卡与数字藏品平台</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .hero {
            background-color: #2c3e50;
            color: white;
            padding: 60px 0;
            text-align: center;
            margin-bottom: 30px;
        }
        .hero h1 {
            font-size: 36px;
            margin-bottom: 20px;
        }
        .hero p {
            font-size: 18px;
            opacity: 0.8;
        }
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        .feature-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: 30px;
            text-align: center;
            transition: transform 0.3s;
        }
        .feature-card:hover {
            transform: translateY(-5px);
        }
        .feature-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        .feature-card p {
            color: #666;
            margin-bottom: 20px;
        }
        .feature-card a {
            display: inline-block;
            padding: 8px 20px;
            background-color: #3498db;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        .feature-card a:hover {
            background-color: #2980b9;
        }
        .recommend-card {
            padding: 20px;
            border-radius: 8px;
            background-color: #f8f9fa;
            margin-top: 20px;
        }
        .recommend-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        .recommend-card .reason {
            margin-top: 15px;
            color: #666;
        }
        /* 登录用户信息样式（核心新增） */
        .login-btn-container {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
        }
        .login-btn-container .user-info {
            display: flex;
            align-items: center;
            gap: 8px;
            color: white;
        }
        .login-btn-container .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: 2px solid white;
            object-fit: cover;
        }
        .login-btn-container .user-menu-btn {
            background: transparent;
            border: none;
            color: white;
            font-size: 16px;
            cursor: pointer;
            padding: 0 5px;
        }
        .login-btn-container .user-dropdown {
            display: none;
            position: absolute;
            top: 45px;
            right: 0;
            background: white;
            border-radius: 6px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.15);
            min-width: 120px;
            z-index: 999;
        }
        .login-btn-container .user-dropdown.show {
            display: block;
        }
        .login-btn-container .dropdown-item {
            padding: 8px 15px;
            color: #333;
            text-decoration: none;
            display: block;
            transition: background-color 0.2s;
        }
        .login-btn-container .dropdown-item:hover {
            background-color: #f8f9fa;
        }
        .login-btn-container .login-link {
            color: white;
            text-decoration: none;
            padding: 5px 10px;
            border-radius: 4px;
            background-color: #3498db;
        }
        .login-btn-container .login-link:hover {
            background-color: #2980b9;
        }
        /* 关于我们按钮样式 */
        .about-us-link {
            color: white;
            text-decoration: none;
            padding: 5px 10px;
            margin-right: 10px;
            border-radius: 4px;
            background-color: #2ecc71;
        }
        .about-us-link:hover {
            background-color: #27ae60;
        }
        /* 搜索栏样式 */
        .search-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        .search-bar input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .search-bar button {
            padding: 8px 20px;
            border: none;
            border-radius: 4px;
            background-color: #3498db;
            color: white;
            cursor: pointer;
        }
        .search-bar button:hover {
            background-color: #2980b9;
        }
        /* 提示框样式 */
        .alert {
            padding: 12px;
            margin: 15px 0;
            border-radius: 4px;
            text-align: center;
            display: none;
        }
        .alert.error {
            display: block;
            background-color: #f8d7da;
            color: #721c24;
        }
        .alert.success {
            display: block;
            background-color: #d4edda;
            color: #155724;
        }
    </style>
</head>
<body data-page-type="index">
<!-- 导航栏：集成登录用户信息展示 -->
<div class="nav">
    <div class="container" style="display: flex; align-items: center;">
        <a href="index.html" class="active">首页</a>
        <a href="check-in.html">文化打卡</a>
        <a href="story.html">文化故事</a>
        <a href="collection.html">数字藏品</a>
        <!-- 个性化功能：未登录时隐藏 -->
        <a id="personalFootprintLink" href="user-footprint.html" style="display: none;">个人足迹</a>
        <a id="collectionMarketLink" href="collection-market.html" style="display: none;">藏品集市</a>
        <!-- 登录/用户信息入口（核心修改） -->
        <div id="loginContainer" class="login-btn-container">
            <!-- 新增：关于我们按钮 -->
            <a href="about-us.html" class="about-us-link">关于我们</a>

            <!-- 未登录状态（默认） -->
            <a href="login.html" class="login-link">登录/注册</a>

            <!-- 登录状态（由api.js动态渲染） -->
        </div>
    </div>
</div>

<!-- 头部横幅 -->
<div class="hero">
    <div class="container">
        <h1>文化打卡与数字藏品平台</h1>
        <p>记录文化足迹，收藏数字瑰宝</p>
    </div>
</div>

<!-- 主内容 -->
<div class="container">
    <!-- 提示框 -->
    <div id="alertBox" class="alert"></div>

    <!-- 搜索栏（大众功能，所有人可见） -->
    <div class="search-bar">
        <input type="text" id="searchInput" placeholder="搜索文化故事/数字藏品...">
        <button onclick="doSearch()">搜索</button>
    </div>

    <!-- 每日推荐：分大众推荐 + 个性化推荐 -->
    <div class="card">
        <!-- 大众推荐（所有人可见） -->
        <h2 style="color: #2c3e50; margin-bottom: 15px;">每日文化推荐</h2>
        <div id="dailyRecommend">
            <p style="text-align:center; padding:20px;">加载中...</p>
        </div>

        <!-- 个性化推荐（仅登录用户可见） -->
        <div id="personalRecommendCard" class="recommend-card" style="display: none; margin-top: 20px;">
            <h2 style="color: #2c3e50; margin-bottom: 15px;">为你定制的文化推荐</h2>
            <div id="personalRecommend">
                <p style="text-align:center; padding:10px;">加载中...</p>
            </div>
        </div>
    </div>

    <!-- 功能卡片：新增个性化功能卡片（登录后显示） -->
    <div class="card-grid">
        <!-- 大众功能卡片（所有人可见） -->
        <div class="feature-card">
            <h3>文化打卡</h3>
            <p>记录你的文化参观足迹，分享你的文化体验</p>
            <a href="check-in.html">立即打卡</a>
        </div>
        <div class="feature-card">
            <h3>文化故事</h3>
            <p>探索丰富的文化故事，了解各地的文化底蕴</p>
            <a href="story.html">查看故事</a>
        </div>
        <div class="feature-card">
            <h3>数字藏品</h3>
            <p>收藏独特的数字文化藏品，传承文化价值</p>
            <a href="collection.html">浏览藏品</a>
        </div>
        <!-- 个性化功能卡片（仅登录用户可见） -->
        <div id="personalFootprintCard" class="feature-card" style="display: none;">
            <h3>个人足迹</h3>
            <p>查看你的专属打卡记录，管理个人文化足迹</p>
            <a href="user-footprint.html">我的足迹</a>
        </div>
        <div id="collectionMarketCard" class="feature-card" style="display: none;">
            <h3>藏品集市</h3>
            <p>购买/交易数字藏品，参与文化藏品流通</p>
            <a href="market.html">进入集市</a>
        </div>
    </div>
</div>

<script src="https://cdn.staticfile.org/axios/1.6.8/axios.min.js"></script>
<script src="js/api.js"></script>
<script>
    // 显示提示框（和api.js中的showAlert保持一致）
    function showAlert(msg, type) {
        const alertBox = document.getElementById('alertBox');
        alertBox.className = `alert ${type}`;
        alertBox.textContent = msg;
        setTimeout(() => {
            alertBox.className = 'alert';
        }, 3000);
    }

    // 搜索功能：移除/api前缀，适配后端接口
    async function doSearch() {
        const keyword = document.getElementById('searchInput').value.trim();
        if (!keyword) {
            showAlert("请输入搜索关键词！", "error");
            return;
        }

        try {
            // 关键修改：移除/api前缀，改为/search
            const res = await axios.get('/search', {
                params: { keyword }
            });
            const data = res.data.data;
            let resultMsg = `搜索结果：
            文化故事：${data.stories?.length || 0}条
            数字藏品：${data.collections?.length || 0}条`;
            showAlert(resultMsg, "success");
        } catch (err) {
            showAlert("搜索失败：" + (err.response?.data?.msg || "暂未实现搜索功能"), "error");
        }
    }

    // 页面加载：调用api.js中的通用初始化函数
    window.onload = async () => {
        await initPage("index");
    };
</script>
</body>
</html>